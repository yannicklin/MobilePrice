angular.module("MobilePriceCompare.TWOUDIA",["ngAnimate","ui.bootstrap","smart-table","angular.filter"]).run(["$rootScope","$log","$filter",function(t,e,a){t.GridData="",t.drawMAPD3=function(t,e,r,o,n,i,c){d3.json(r,function(r,d){var l=topojson.feature(d,d.objects.Areas),s=.1,p=.1;for(idx=l.features.length-1;idx>=0;idx--){var u=a("filter")(o,{country_iso:l.features[idx].properties.iso_a3},!0);0==u.length?l.features[idx].properties.baseprice_date=0:(l.features[idx].properties.baseprice_date=Math.round(u[0].baseprice_date),l.features[idx].properties.price=u[0].price,l.features[idx].properties.currency=u[0].currency,l.features[idx].properties.basecurrency=u[0].basecurrency,u[0].baseprice_date<s&&(s=u[0].baseprice_date),u[0].baseprice_date>p&&(p=u[0].baseprice_date))}var m=d3.geo.robinson().scale(1).translate([0,0]),f=d3.geo.path().projection(m),h=f.bounds(l),g=.95/Math.max((h[1][0]-h[0][0])/t,(h[1][1]-h[0][1])/e),w=[(t-g*(h[1][0]+h[0][0]))/2,(e-g*(h[1][1]+h[0][1]))/2];m.scale(g).translate(w),n.selectAll("path").data(l.features).enter().append("path").attr("d",f).attr("id",function(t){return t.properties.sovereignt}).style("stroke-width","1").style("stroke","white").on("click",function(a){a.properties.baseprice_date>0&&(c.html(a.properties.name+"<br /><br />Original: "+a.properties.currency+" "+a.properties.price+"<br />Converted: "+a.properties.basecurrency+" "+a.properties.baseprice_date).style("left",parseInt(n.node().getBoundingClientRect().left+window.pageXOffset+t/2-100)+"px").style("top",parseInt(n.node().getBoundingClientRect().top+window.pageYOffset+e/2-30)+"px"),c.transition().duration(500).style("opacity",.9).transition().duration(500).style("opacity",0).delay(4e3))}).on("mouseover",function(t){i.html(t.properties.name).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px"),i.transition().duration(200).style("opacity",.9)}).on("mouseout",function(t){i.transition().duration(200).style("opacity",0)});var y=d3.scale.linear().domain([s,p]).range(["#FFFFCC","#E8A317"]);n.selectAll("path").data(l.features).attr({d:f,fill:function(t){return 0==t.properties.baseprice_date?"#708090":y(t.properties.baseprice_date)}})})}}]).config([function(){}]).controller("TWCtrl",["$scope","$log","$filter","$http",function(t,e,a,r){t.form={},t.tabs=[{title:"Globe",template:"views/globe.html"},{title:"Asia",template:"views/asia.html"},{title:"Europe",template:"views/europe.html"},{title:"Africa",template:"views/africa.html"},{title:"Oceania",template:"views/oceania.html"},{title:"North America",template:"views/northamerica.html"},{title:"South America",template:"views/southamerica.html"}],r.get("recordFetch.php?table=v_product").success(function(e){t.optProductBrand=a("unique")(e,"brand"),t.optProductModelRAW=a("unique")(e,"con_B_M"),t.optProductSPECRAW=e,t.form.selProductBrand=t.optProductModelRAW[0].brand,t.selProductBrandChanged()}),r.get("recordFetch.php?table=v_currency").success(function(e){t.optCurrency=e}),t.selProductBrandChanged=function(){t.optProductModel=a("filter")(t.optProductModelRAW,{brand:t.form.selProductBrand},!0),t.form.selProductModel=t.optProductModel[0].model,t.selProductModelChanged()},t.selProductModelChanged=function(){t.optProductSPEC=a("filter")(t.optProductSPECRAW,{brand:t.form.selProductBrand,model:t.form.selProductModel},!0),t.form.selProductSPEC=t.optProductSPEC[0].spec},t.selProductSPECChanged=function(){},t.form.inpEXDate=new Date((new Date).setDate((new Date).getDate()-1)),t.inpEXDatePopup={opened:!1},t.inpEXDateOpt={format:"yyyy-MM-dd",maxDate:new Date((new Date).setDate((new Date).getDate()-1)),minDate:new Date((new Date).setDate((new Date).getDate()-90)),startingDay:0,showWeeks:!1},t.inpEXDateClick=function(){t.inpEXDatePopup.opened=!0},t.form.selCurrency="USD",t.selCurrencyChanged=function(){t.GridData&&t.priceEnquiry()},t.$watchCollection("form",function(){t.GridData="";var e=!0;t.form.selProductBrand||(e=!1),t.form.selProductModel||(e=!1),t.form.selProductSPEC||(e=!1),t.form.selProductBrand||(e=!1),t.form.inpEXDate||(e=!1),t.condsCompleted=e}),t.priceEnquiry=function(){t.condsCompleted&&(t.GridData="",r.get("recordFetch.php?table=v_pricesummary&cond=y&brand="+encodeURIComponent(t.form.selProductBrand)+"&model="+encodeURIComponent(t.form.selProductModel)+"&spec="+encodeURIComponent(t.form.selProductSPEC)+"&basecurrency="+encodeURIComponent(t.form.selCurrency)+"&ratedate="+encodeURIComponent(a("date")(t.form.inpEXDate,"yyyy-MM-dd"))).success(function(e){t.GridData=e}))},t.copyrightsyear=(new Date).getFullYear()>2016?"2016 - "+(new Date).getFullYear():"2016"}]).controller("GlobeCtrl",["$scope","$log","$window",function(t,e,a){function r(){o=parseInt(d3.select("#globemap").style("width"),10),n=.5*o,i.attr("width",o).attr("height",n),t.drawMAPD3(o,n,"geo/worldmap-2016.topo.json",t.twGrid,i,c,d)}var o=parseInt(d3.select("#globemap").style("width"),10),n=.5*o,i=d3.select("#globemap").append("svg").attr("width",o).attr("height",n),c=d3.select("#globemap").append("div").attr("class","tooltip").style("opacity",0),d=d3.select("#globemap").append("div").attr("class","popover").style("opacity",0);t.$watchCollection("GridData",function(){t.twGrid=t.GridData,r()}),angular.element(a).bind("orientationchange",function(){r()}),angular.element(a).bind("resize",function(){r()})}]).controller("AsiaCtrl",["$scope","$log","$filter","$window",function(t,e,a,r){function o(){n=.9*parseInt(d3.select("#asiamap").style("width"),10),i=.7*n,c.attr("width",n).attr("height",i),t.drawMAPD3(n,i,"geo/asia-2016.topo.json",t.twGrid,c,d,l)}var n=.9*parseInt(d3.select("#asiamap").style("width"),10),i=.7*n,c=d3.select("#asiamap").append("svg").attr("width",n).attr("height",i),d=d3.select("#asiamap").append("div").attr("class","tooltip").style("opacity",0),l=d3.select("#asiamap").append("div").attr("class","popover").style("opacity",0);t.$watchCollection("GridData",function(){t.twGrid=a("filter")(t.GridData,{continent:"Asia"},!0),o()}),angular.element(r).bind("orientationchange",function(){o()}),angular.element(r).bind("resize",function(){o()})}]).controller("EuropeCtrl",["$scope","$log","$filter","$window",function(t,e,a,r){function o(){n=.9*parseInt(d3.select("#europemap").style("width"),10),i=.3*n,c.attr("width",n).attr("height",i),t.drawMAPD3(n,i,"geo/europe-2016.topo.json",t.twGrid,c,d,l)}var n=.9*parseInt(d3.select("#europemap").style("width"),10),i=.3*n,c=d3.select("#europemap").append("svg").attr("width",n).attr("height",i),d=d3.select("#europemap").append("div").attr("class","tooltip").style("opacity",0),l=d3.select("#europemap").append("div").attr("class","popover").style("opacity",0);t.$watchCollection("GridData",function(){t.twGrid=a("filter")(t.GridData,{continent:"Europe"},!0),o()}),angular.element(r).bind("orientationchange",function(){o()}),angular.element(r).bind("resize",function(){o()})}]).controller("AfricaCtrl",["$scope","$log","$filter","$window",function(t,e,a,r){function o(){n=.6*parseInt(d3.select("#africamap").style("width"),10),i=1*n,c.attr("width",n).attr("height",i),t.drawMAPD3(n,i,"geo/africa-2016.topo.json",t.twGrid,c,d,l)}var n=.6*parseInt(d3.select("#africamap").style("width"),10),i=1*n,c=d3.select("#africamap").append("svg").attr("width",n).attr("height",i),d=d3.select("#africamap").append("div").attr("class","tooltip").style("opacity",0),l=d3.select("#africamap").append("div").attr("class","popover").style("opacity",0);t.$watchCollection("GridData",function(){t.twGrid=a("filter")(t.GridData,{continent:"Africa"},!0),o()}),angular.element(r).bind("orientationchange",function(){o()}),angular.element(r).bind("resize",function(){o()})}]).controller("OceaniaCtrl",["$scope","$log","$filter","$window",function(t,e,a,r){function o(){n=.7*parseInt(d3.select("#oceaniamap").style("width"),10),i=.8*n,c.attr("width",n).attr("height",i),t.drawMAPD3(n,i,"geo/oceania-2016.topo.json",t.twGrid,c,d,l)}var n=.7*parseInt(d3.select("#oceaniamap").style("width"),10),i=.8*n,c=d3.select("#oceaniamap").append("svg").attr("width",n).attr("height",i),d=d3.select("#oceaniamap").append("div").attr("class","tooltip").style("opacity",0),l=d3.select("#oceaniamap").append("div").attr("class","popover").style("opacity",0);t.$watchCollection("GridData",function(){t.twGrid=a("filter")(t.GridData,{continent:"Oceania"},!0),o()}),angular.element(r).bind("orientationchange",function(){o()}),angular.element(r).bind("resize",function(){o()})}]).controller("NorthAmericaCtrl",["$scope","$log","$filter","$window",function(t,e,a,r){function o(){n=.9*parseInt(d3.select("#northamericamap").style("width"),10),i=.6*n,c.attr("width",n).attr("height",i),t.drawMAPD3(n,i,"geo/northamerica-2016.topo.json",t.twGrid,c,d,l)}var n=.9*parseInt(d3.select("#northamericamap").style("width"),10),i=.6*n,c=d3.select("#northamericamap").append("svg").attr("width",n).attr("height",i),d=d3.select("#northamericamap").append("div").attr("class","tooltip").style("opacity",0),l=d3.select("#northamericamap").append("div").attr("class","popover").style("opacity",0);t.$watchCollection("GridData",function(){t.twGrid=a("filter")(t.GridData,{continent:"North America"},!0),o()}),angular.element(r).bind("orientationchange",function(){o()}),angular.element(r).bind("resize",function(){o()})}]).controller("SouthAmericaCtrl",["$scope","$log","$filter","$window",function(t,e,a,r){function o(){n=.5*parseInt(d3.select("#southamericamap").style("width"),10),i=1.5*n,c.attr("width",n).attr("height",i),t.drawMAPD3(n,i,"geo/southamerica-2016.topo.json",t.twGrid,c,d,l)}var n=.5*parseInt(d3.select("#southamericamap").style("width"),10),i=1.5*n,c=d3.select("#southamericamap").append("svg").attr("width",n).attr("height",i),d=d3.select("#southamericamap").append("div").attr("class","tooltip").style("opacity",0),l=d3.select("#southamericamap").append("div").attr("class","popover").style("opacity",0);t.$watchCollection("GridData",function(){t.twGrid=a("filter")(t.GridData,{continent:"South America"},!0),o()}),angular.element(r).bind("orientationchange",function(){o()}),angular.element(r).bind("resize",function(){o()})}]).directive("stRatio",function(){return{link:function(t,e,a){var r=+a.stRatio;e.css("width",r+"%")}}});